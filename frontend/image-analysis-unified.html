<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Analysis - Filterize AI</title>
    <link rel="stylesheet" href="/frontend/unified-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <nav class="nav">
            <a href="/" class="logo">
                <i class="fas fa-shield-check"></i>
                Filterize AI
            </a>
            <a href="/" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Back to Dashboard
            </a>
        </nav>
    </header>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">üñºÔ∏è Image Analysis</h1>
            <p class="page-subtitle">
                Advanced AI image detection using metadata analysis, visual artifacts, and pattern recognition
            </p>
        </div>

        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-upload"></i>
                Upload Image for Analysis
            </h2>
            
            <div class="upload-area" onclick="document.getElementById('imageInput').click()">
                <div class="upload-icon">
                    <i class="fas fa-image"></i>
                </div>
                <div class="upload-text">Click to upload image or drag and drop</div>
                <div class="upload-subtext">Supports JPEG, PNG, GIF, WebP files (Max: 10MB)</div>
            </div>
            
            <input type="file" id="imageInput" class="file-input" accept="image/*" onchange="handleFileSelect(this)">
            
            <button class="btn btn-primary btn-large" id="analyzeImageBtn" onclick="analyzeImage()" disabled>
                <i class="fas fa-search"></i>
                Analyze Image
            </button>

            <div class="loading" id="loadingSection">
                <div class="spinner"></div>
                <p>Analyzing image for AI generation patterns...</p>
            </div>

            <div class="results-section" id="resultsSection">
                <div class="result-card">
                    <div class="result-title">
                        <i class="fas fa-chart-bar"></i>
                        Analysis Results
                    </div>
                    <div class="result-content" id="analysisResults">
                        Results will appear here after analysis...
                    </div>
                </div>

                <div class="result-card">
                    <div class="result-title">
                        <i class="fas fa-percentage"></i>
                        AI Probability
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-ai" id="aiProgressBar"></div>
                    </div>
                    <div class="result-content" id="probabilityText">0% AI Generated</div>
                </div>

                <div class="result-card">
                    <div class="result-title">
                        <i class="fas fa-microscope"></i>
                        Detection Details
                    </div>
                    <div class="result-content" id="detectionDetails">
                        Detailed analysis information will appear here...
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-cogs"></i>
                Image Analysis Features
            </h2>
            <div class="grid grid-2">
                <div class="card">
                    <div class="result-title">
                        <i class="fas fa-eye"></i>
                        Visual Artifact Detection
                    </div>
                    <p class="result-content">Advanced algorithms to detect AI generation artifacts and patterns</p>
                </div>
                <div class="card">
                    <div class="result-title">
                        <i class="fas fa-info-circle"></i>
                        Metadata Analysis
                    </div>
                    <p class="result-content">Comprehensive examination of image metadata and EXIF data</p>
                </div>
                <div class="card">
                    <div class="result-title">
                        <i class="fas fa-compress"></i>
                        Compression Analysis
                    </div>
                    <p class="result-content">Analysis of compression patterns and encoding signatures</p>
                </div>
                <div class="card">
                    <div class="result-title">
                        <i class="fas fa-palette"></i>
                        Color Distribution
                    </div>
                    <p class="result-content">Statistical analysis of color patterns and distributions</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;

        function handleFileSelect(input) {
            const file = input.files[0];
            if (file) {
                selectedFile = file;
                document.getElementById('analyzeImageBtn').disabled = false;
                
                // Update upload area text
                const uploadArea = document.querySelector('.upload-area');
                uploadArea.innerHTML = `
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">‚úÖ ${file.name}</div>
                    <div class="upload-subtext">Size: ${(file.size / (1024*1024)).toFixed(2)} MB</div>
                `;
            }
        }

        async function analyzeImage() {
            if (!selectedFile) return;

            // Show loading
            document.getElementById('loadingSection').classList.add('show');
            document.getElementById('resultsSection').classList.remove('show');
            document.getElementById('analyzeImageBtn').disabled = true;

            try {
                // Simulate image upload and analysis
                const formData = new FormData();
                formData.append('file', selectedFile);
                formData.append('type', 'image');

                const response = await fetch('/api/upload-analyze', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                // Hide loading
                document.getElementById('loadingSection').classList.remove('show');
                
                if (result.error) {
                    throw new Error(result.error);
                }

                // Display results
                displayResults(result);
                
            } catch (error) {
                console.error('Analysis failed:', error);
                document.getElementById('loadingSection').classList.remove('show');
                alert('Analysis failed: ' + error.message);
            } finally {
                document.getElementById('analyzeImageBtn').disabled = false;
            }
        }

        function displayResults(result) {
            const resultsSection = document.getElementById('resultsSection');
            const analysisResults = document.getElementById('analysisResults');
            const probabilityText = document.getElementById('probabilityText');
            const progressBar = document.getElementById('aiProgressBar');
            const detectionDetails = document.getElementById('detectionDetails');

            // Show results section
            resultsSection.classList.add('show');

            // Extract data from the actual response structure
            const aiAnalysis = result.ai_analysis || {};
            const credibility = aiAnalysis.credibility_assessment || {};
            const factCheckScore = result.fact_check_score || credibility.score || 0;
            const aiProb = Math.max(0, 100 - factCheckScore); // Convert credibility to AI probability
            const isAI = aiProb > 50;
            
            // Update analysis results
            analysisResults.innerHTML = `
                <div class="mb-sm"><strong>Status:</strong> ${isAI ? '‚ö†Ô∏è Likely AI Generated' : '‚úÖ Appears Human Created'}</div>
                <div class="mb-sm"><strong>Confidence:</strong> ${credibility.confidence || 'High'}</div>
                <div class="mb-sm"><strong>Analysis Method:</strong> ${result.analysis_method || 'AI Integrated'}</div>
                <div class="mb-sm"><strong>Detection Score:</strong> ${factCheckScore}%</div>
            `;

            // Update probability
            probabilityText.textContent = `${aiProb}% AI Generated`;
            progressBar.style.width = `${aiProb}%`;

            // Update detection details
            let detailsHTML = '';
            
            // Add key insights
            if (aiAnalysis.key_insights && aiAnalysis.key_insights.length > 0) {
                detailsHTML += '<div class="mb-md"><strong class="text-success">Analysis Results:</strong><br>';
                aiAnalysis.key_insights.forEach(insight => {
                    detailsHTML += `<span class="text-success">‚Ä¢ ${insight}</span><br>`;
                });
                detailsHTML += '</div>';
            }

            // Add recommendations
            if (aiAnalysis.recommendations && aiAnalysis.recommendations.length > 0) {
                detailsHTML += '<div class="mb-md"><strong class="text-warning">Recommendations:</strong><br>';
                aiAnalysis.recommendations.forEach(rec => {
                    detailsHTML += `<span class="text-warning">‚Ä¢ ${rec}</span><br>`;
                });
                detailsHTML += '</div>';
            }

            // Add credibility factors
            if (credibility.factors && credibility.factors.length > 0) {
                detailsHTML += '<div class="mb-md"><strong class="text-info">Analysis Factors:</strong><br>';
                credibility.factors.forEach(factor => {
                    detailsHTML += `<span class="text-info">‚Ä¢ ${factor}</span><br>`;
                });
                detailsHTML += '</div>';
            }

            // Add analysis metrics
            detailsHTML += `
                <div class="grid grid-2 mt-md">
                    <div><strong>Content Type:</strong> ${aiAnalysis.content_type || 'Image Analysis'}</div>
                    <div><strong>Processing Time:</strong> ${result.metadata?.processing_time || 'N/A'}</div>
                    <div><strong>Analysis Date:</strong> ${aiAnalysis.analysis_date ? new Date(aiAnalysis.analysis_date).toLocaleDateString() : 'N/A'}</div>
                    <div><strong>Server Version:</strong> ${result.metadata?.server_version || 'N/A'}</div>
                </div>
            `;

            detectionDetails.innerHTML = detailsHTML || 'Detailed analysis metrics will be displayed here.';
        }

        // Allow drag and drop
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });
        
        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('imageInput').files = files;
                handleFileSelect(document.getElementById('imageInput'));
            }
        });
    </script>
</body>
</html>